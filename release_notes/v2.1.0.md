v2.1.0 Release Notes - April XX, 2020
========================================

What's New in Hyperledger Fabric v2.1
-------------------------------------

**FAB-17357: Add endorser metric for simulation failure**

Added metric endorser_proposal_simulation_failures.


**FAB-14761: Limit concurrent requests to endorser and deliver services**

Limits can now be placed on the number of endorser and deliver requests
that a peer will process at any one time. If a peer is already processing its
limit of requests, subsequent requests in excess of the limit will return an error,
and the client will need to retry the call. The limits are configured using the
following core.yaml properties:
- peer.limits.concurrency.endorserService
- peer.limits.concurrency.deliverService

**FAB-17463: Allow peer to override implicit collection dissemination properties**

The following config properties have been added to peer's core.yaml
for implicit private data collection dissemination:
- peer.gossip.pvtData.ImplicitCollectionDisseminationPolicy.requiredPeerCount
- peer.gossip.pvtData.ImplicitCollectionDisseminationPolicy.maxPeerCount

When a peer endorses a transaction that writes to its own organization's
implicit private data collection, the new properties will dictate how
many other peers in the organization the endorsing peer will attempt to
disseminate to (maxPeerCount), and how many peers must acknowledge receipt
of the private data before endorsement succeeds (requiredPeerCount).
These properties are applicable to all channels the peer has joined. The implication
is that requiredPeerCount has to be smaller than the number of peers in a channel
that has the lowest numbers of peers from the organization.

**FAB-17299: Support collection level endorsement policies for discovery**

* PoliciesByChaincode now returns one InquireablePolicy per collection,
either the collection's endorsement policy if one exists or the
chaincode policy by default
* chaincode.Metadata now stores CollectionPolicies for lifecycle
namespace chaincodes that have collection endorsement policies


**Discover CLI now supports SEC 1 formatted private keys**
Private keys that are generated with openssl ecparam (SEC 1 format) are now supported
with the discover CLI, in addition to the PKCS8 private keys that were already supported.


**Dependency updates**

- Bump docker images to Alpine 3.11.
- Bump Go to 1.14.1.
- Bump Go grpc to 1.28.0.


Fixes
-----

**FAB-17458: Rolling upgrade: Different endorsement results on v1.4.x and v2.0.0 peers (FIX ALSO IN V2.0.1)**

In a rolling upgrade scenario where V2_0 channel application capability is not yet set,
and proposals are sent to v1.4.x peers and v2.0.0 peers,
the endorsed read sets did not exactly match in the proposal response between
the v1.4.x peers and v2.0.0 peers. A client would therefore have to get
endorsements from only v1.4.x peers, or only from v2.0.0 peers, making it difficult
to get sufficient number of matching endorsements to meet the endorsement policy.
If a transaction is submitted with insufficient matching endorsements, the
transaction will be invalidated at commit time with error message
"marked as invalid by committer. Reason code [ENDORSEMENT_POLICY_FAILURE]".
The proposal response is fixed in v2.0.1 so that the read sets will exactly
match read sets on v1.4.x peers, enabling transactions to be endorsed across
peers of different versions.

**FAB-17479: Migrated Kafka cluster can be safely expanded later (FIX ALSO IN V2.0.1)**

When a new ordering service node was added to a migrated Kafka cluster,
but was not added to all channels, the ordering service node would crash.
The fix ensures that new ordering nodes can be added to a subset of channels.

**FAB-17453: 'peer lifecycle chaincode package' required an MSP configured (FIX ALSO IN V2.0.1)**

'peer lifecycle chaincode package' is for local packaging of chaincode only,
and therefore no longer requires a MSP to be configured.

**FAB-17059: Change collection membership eligibility checks to only compare mspID (FIX ALSO IN V2.0.1)**

When a new CA root cert was added to an organization in the channel configuration,
new peers with an identity from the new CA would not receive private data for
blocks prior to the channel configuration change. This is because the peer didn't
realize it was a member of the private data collection, even though it was
based on the collection's mspid. The fix ensures that the peer evaluates
private data collection membership based on its mspid. The fix is important
when rotating CA root or intermediate certs, for example in a side-by-side
migration scenario that uses new CA certs and new peers.

**FAB-17519: Improve Discovery endorsement policy performance (FIX ALSO IN V2.0.1)**

Fix peer CPU spikes during evaluation of endorsement policy
combinations, due to expensive reflection.

**FAB-17523: Endorsing peer was not honoring private data RequiredPeerCount (FIX ALSO IN V2.0.1)**

If there were not enough known eligible peers to meet the private data collection RequiredPeerCount
dissemination requirement, endorsement was succeeding rather than returning an error.

**FAB-17491: Do not disseminate private data for other organization's implicit collection (FIX ALSO IN V2.0.1)**

When using the new implicit private data collections in v2.0.0, in some use cases
private data needs to be written to each of multiple organization's implicit
private data collections in the same transaction. In these cases the endorsing peers were
disseminating the private data to each of the respective organization's peers.
Although not a security problem (each organization is authorized to receive its
own implicit collection private data), dissemination should be managed by the endorsing
peers of the implicit collection organization only. This fix ensures that only peers
of the implicit collection organization disseminate the private data to their own
organization's other peers.

**FAB-17515: Support configuring BlockValidation policy for orderer group (FIX ALSO IN V2.0.1)**

Prior to the fix, a configured BlockValidation policy (e.g. defined in configtx.yaml)
would be ignored. The policy is now applied in the channel creation transaction, and
must be specified.

**FAB-17441: approveformyorg lifecycle command should allow update of only package ID**

approveformyorg lifecycle command now allows only the package ID to be updated.

**Fix nil dereference in etcdraft config parsing**

The etcdraft config parsing code checked that the consensus
metadata was not nil, but it failed to check that the options were not nil.
The additional nil checks have been added.

**FAB-17517: Only Initialize specified BCCSP provider**

When Fabric is built with GO_TAGS="pkcs11",
BCCSP attempted to initialize PKCS11 even when BCCSP is configured for software.
This resulted in error
"Failed to initialize local MSP: could not initialize BCCSP Factories: Failed initializing PKCS11.BCCSP"

**FAB-17672: Prevent gossip probes from registering as long lasting connections**

This fix helps to more quickly establish gossip connections when
peers are starting at the same time.

For the full list of changes, refer to the release change log:
https://github.com/hyperledger/fabric/blob/release-2.1/CHANGELOG.md#v210
